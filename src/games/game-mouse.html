<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../shared-styles.html">
<script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>

<dom-module id="game-mouse">
  <template>
      <style include="shared-styles">
      :host {

      }

      .game-settings {
        text-align: center;
        position: absolute;
        height: 50%;
        width: 50%;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        margin: auto;
      }

      #container {
        width: 100%;
        height: 100vh;
      }

    </style>

    <div class="card game-settings" hidden$="[[gameStarted]]">
      <h1>Mouse Accuracy</h1>
      <p>Ut labores minimum atomorum pro. Laudem tibique ut has.</p>
      <p>Lorem ipsum dolor sit amet, per in nusquam nominavi periculi.</p>
      <paper-button class="button" on-click="start">start</paper-button>
    </div>

    <div id="container"></div>
  </template>
  <script>

    class GameMouse extends Polymer.Element {
      static get is() { return "game-mouse"; }
      static get properties() {
        return {
          gameStarted: {
            type: Boolean,
            value: false,
            notify: true
          },
          setting: {
            type: Object,
            notify: true
          }
        }
      }

      ready() {
        super.ready()
      }

      start() {
        this.gameStarted = true;

        this.time           = 20000;
        this.frequency      = 1000;
        this.lifeSpan       = 100;
        this.circleSize     = 5;

        let container = d3.select(this.$.container);
        let width = container.node().offsetWidth;
        let height = container.node().offsetHeight;

        container.select("svg").remove();
        let svg = container.append("svg")
                    .attr("width", width)
                    .attr("height", height)
                  .append("g");

        let xScale = d3.scaleLinear().range([0, width])
                                     .domain([-100, 100]);
        this.xScale = xScale;
        let yScale = d3.scaleLinear().range([height, 0])
                                     .domain([-100, 100]);
        this.yScale = yScale;

        let interval = setInterval(function() {
          let x = d3.randomUniform(-100,100)();
          let y = d3.randomUniform(-100,100)();

          svg.append("circle")
              .attr("r", this.circleSize)
              .attr("cx", this.xScale(x))
              .attr("cy", this.yScale(y));
        }.bind(this), this.frequency);

        setTimeout(() => {
          clearInterval(interval);
          container.select("svg").remove();
          this.gameStarted = false;
        }, this.time);
      }
    }
    window.customElements.define(GameMouse.is, GameMouse);
  </script>
</dom-module>
